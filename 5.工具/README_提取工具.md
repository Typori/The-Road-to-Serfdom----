# 译文提取工具使用说明

## 工具简介

`extract_translation.py` 是一个用于从翻译工作区的 Markdown 文件中提取纯译文的工具。

## 功能特点

1. **提取译文内容**：只保留 `[译文]` 标记后的中文翻译内容
2. **移除标识符**：自动移除 `<!-- pX.sY -->` 段落标识符
3. **保留结构**：保留章节划分（`##` 标题）
4. **智能换行**：
   - 句子切换（s1 → s2）：单个换行
   - 段落切换（p1 → p2）：双换行（段间空行）
5. **元数据保留**：提取并保留 YAML 头部的标题、章节号等信息

## 使用方法

### 方法一：直接运行（推荐）

```bash
# 进入工具目录
cd "e:\个人\书籍\The-Road-to-Serfdom翻译工程\5.工具"

# 运行脚本
python extract_translation.py
```

运行后会显示菜单，可以选择：
- 单个文件处理
- 全部文件批量处理

### 方法二：命令行参数

```bash
# 处理指定文件
python extract_translation.py --input "文件路径.md"

# 指定输出目录
python extract_translation.py --output "输出目录"
```

## 输入文件格式要求

输入文件应该是标准的翻译工作区格式：

```markdown
---
title: "章节标题"
chapter: 1
revision: "版本号"
---

## 第一节：标题

[原文]
> Original text here

[译文]
这是翻译的文本。<!-- p1.s1 -->

[原文]
> More original text

[译文]
更多翻译文本。<!-- p1.s2 -->
```

## 输出文件

- **位置**：`4.译文/` 目录
- **命名**：`原文件名_译文.md`
- **格式**：纯 Markdown，包含标题、元数据和译文内容

### 输出示例

```markdown
# 被放弃的道路

> 第 1 章 | 版本: v1.0 | 日期: 2025-11-14

---

## 第一节：标题

这是翻译的文本。

更多翻译文本。


新段落的文本。
```

## 处理规则说明

### 1. 段落编号规则

- `p1.s1` → `p1.s2`：同段落内句子切换 → **单换行**
- `p1.s2` → `p2.s1`：段落切换 → **双换行**（段间空行）

### 2. 过滤规则

以下内容会被自动跳过：
- `[原文]` 部分
- 注释章节（`## 注释`）
- 修订记录（`## 本章修订记录`）
- 段落标识符（`<!-- pX.sY -->`）

### 3. 保留内容

- 章节标题（`## 第X节：XXX`）
- YAML 元数据（标题、章节号、版本、日期）
- 注释引用（`[注-原-X]`、`[注-译-X]`）

## 常见问题

### Q: 输出文件乱码怎么办？

A: 本工具使用 UTF-8 编码，确保你的文本编辑器也使用 UTF-8 打开文件。

### Q: 可以批量处理多个文件吗？

A: 可以，运行工具后选择 `[A] 全部文件` 选项。

### Q: 输出文件在哪里？

A: 默认输出到 `4.译文/` 目录，与翻译工作区同级。

### Q: 如何修改输出格式？

A: 编辑 `extract_translation.py`，修改 `build_output()` 函数中的格式设置。

## 技术说明

- **语言**：Python 3.6+
- **依赖**：仅使用标准库（`os`, `re`, `sys`, `pathlib`）
- **编码**：UTF-8（输入输出均为）
- **换行符**：LF（`\n`）

## 更新历史

- **2025-11-14**：初始版本
  - 基本提取功能
  - 智能换行处理
  - 元数据保留

## 作者

翻译工程配套工具
